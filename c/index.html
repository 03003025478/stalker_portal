<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>stalker_portal</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">

/* GLOBAL STYLES */

.text20_white{
    font-size: 20px;
    color: #fff;
}

.bold{
    font-weight: bold;
}

.uppercase{
    text-transform: uppercase;
}

/* END GLOBAL STYLES */

</style>

<script type="text/javascript" src="version.js"></script>

<script type="text/javascript" src="global.js"></script>

<script type="text/javascript" src="JsHttpRequest.js"></script>

<script type="text/javascript" src="keydown.keycodes.js"></script>
<script type="text/javascript" src="keydown.observer.js"></script>

<script type="text/javascript" src="watchdog.js"></script>
<script type="text/javascript" src="usbdisk.js"></script>
<script type="text/javascript" src="pvr.js"></script>

<script type="text/javascript" src="load_bar.js"></script>
<script type="text/javascript" src="xpcom.common.js"></script>
<script type="text/javascript" src="xpcom.webkit.js"></script>

<script type="text/javascript" src="blocking.js"></script>

<script type="text/javascript" src="player.js"></script>

<script type="text/javascript">

var debug = 0;
var stb;
var _GET = {};
var gmode = '';
var img_prefix = '';

var module = module || {};
var word = {};

window.onerror = function(msg, url, lno){
    _debug('line: '+lno+'; msg: "'+msg+'" url: '+url);
    return true;
};

get_params();

if (_GET.hasOwnProperty('debug')){
    debug = 1;
}

if (_GET.hasOwnProperty('referrer')){
    var referrer = _GET['referrer'];
}else{
    referrer = '';
}

if (_GET.hasOwnProperty('default_module')){
    var default_module = _GET['default_module'];
}else{
    default_module = '';
}

//referrer = document.referrer ? document.referrer : referrer;

window.onload = init;

var loader = {
    
    chain : [],
    cur_idx : -1,
    head : document.getElementsByTagName("head")[0],
    max_load_percent : 50,
    step : 0,
    
    add : function(modules){
        _debug('loader.add');
        
        modules = modules || [];
        
        this.cur_idx = -1;
        
        for (var i=0; i<modules.length; i++){
            if (this.chain.indexOf(modules[i]) >= 0){
                modules.splice(i, 1);
            }
        }
        
        this.chain = modules;
        
        this.step = Math.ceil(this.max_load_percent/this.chain.length);
        
        this.next();
    },
    
    next : function(){
        _debug('loader.next');
        
        if (this.cur_idx < this.chain.length-1){
            this.cur_idx++;
            this.append(this.chain[this.cur_idx]);
        }
    },
    
    append : function(module){
        _debug('loader.append');
        
        stb.loader.add_pos(this.step, 'append '+module);
        
        var _style = document.createElement('link');
        _style.type = "text/css";
        _style.rel = "stylesheet";
        _style.href = module + (gmode ? '_'+gmode : '') +".css";
        this.head.appendChild(_style);
        _debug('append', _style.href);
        
        var _script = document.createElement('script');
        _script.type = "text/javascript";
        _script.src  = module + ".js";
        this.head.appendChild(_script);
        _debug('append', _script.src);
    }
};

/**
 * Init STB.
 */
function init(){
    _debug('init');

    /*if (typeof(gSTB) != 'undefined'){
        if (gSTB.RDir('gmode') != 720){
            gmode = '720';
        }
    }else{
        if (window.innerWidth > 720){
            gmode = '720';
        }
    }*/

    if (gmode){
        img_prefix = '_'+gmode;
    }

    window.moveTo(0, 0);
    
    if (gmode == '720'){
        window.resizeTo(1280, 720);
    }else{
        window.resizeTo(720, 576);
    }
    
    stb.loader = new load_bar();
    stb.loader.bind();
    
    stb.loader.set_callback(
        function(){
            stb.post_loading_handle();
        }
    );
    
    /*var base_modules = [
        "layer.base",
        "layer.list",
        "layer.setting",
        "layer.input",
        "layer.sidebar",
        "layer.search_box",
        "layer.bottom_menu",
        "layer.scrollbar",
        "layer.vclub_info",
        "password_input",
        "series_switch",
    ]*/
    
    //var all_modules = base_modules.concat(ext_modules);
    
    //_debug('all_modules', all_modules);
    
    //loader.add(all_modules);
    
    stb.init();
    
    (function(){
        
        if (stb.player.on){
            
            if (stb.player.con_menu.on){
                stb.player.con_menu.hide();
            }
            
            stb.player.prev_layer && stb.player.prev_layer.hide && stb.player.prev_layer.hide();
            
            stb.player.stop();
            main_menu.show();
        }
        
    }).bind(key.MENU);
    
    (function(){
        
        stb.cur_layer && stb.cur_layer.hide && stb.cur_layer.hide();
        
        if (module && module.tv){
            stb.set_cur_place(module.tv.layer_name);
            stb.set_cur_layer(module.tv);
        }

        if (!module.blocking.on){
            stb.player.play_last();
        }
        
    }).bind(key.TV);
    
    (function(){
        
        stb.switchPower();
        
    }).bind(key.POWER);

    /* END LAYER MANAGEMENT */
    
}

</script>

</head>
<body>
<img src="i/loading_bg.gif" width="0" height="0"/>
<img src="i/loading.png" width="0" height="0"/>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>stalker_portal</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="reset.css" type="text/css" />
<link rel="stylesheet" href="main_menu.css" type="text/css" />

<style type="text/css">

/* GLOBAL STYLES */

.text24_white{
    font-size: 24px;
    color: #fff;
}

.text25_white{
    font-size: 25px;
    color: #fff;
}

.text20_white{
    font-size: 20px;
    color: #fff;
}

.text14_white{
    font-size: 14px;
    color: #fff;
}

.text15_white{
    font-size: 15px;
    color: #fff;
}

.text18_white{
    font-size: 18px;
    color: #fff;
}

.bold{
    font-weight:bold;
}

.uppercase{
    text-transform: uppercase;
}

.align_justify{
    text-align: justify;
}

.shadow_dark2{
    text-shadow: #000 -1px -1px 0;
}
/* END GLOBAL STYLES */

</style>

<link type="text/css" rel="stylesheet" href="load_bar.css"></link>
<link type="text/css" rel="stylesheet" href="alert.css"></link>
<link type="text/css" rel="stylesheet" href="context_menu.css"></link>

<script type="text/javascript" src="l/ru.js"></script>

<script type="text/javascript" src="global.js"></script>

<script type="text/javascript" src="alert.js"></script>

<script type="text/javascript" src="JsHttpRequest.js"></script>

<script type="text/javascript" src="keydown.keycodes.js"></script>
<script type="text/javascript" src="keydown.observer.js"></script>

<script type="text/javascript" src="watchdog.js"></script>
<script type="text/javascript" src="usbdisk.js"></script>
<script type="text/javascript" src="pvr.js"></script>

<script type="text/javascript" src="load_bar.js"></script>
<script type="text/javascript" src="xpcom.common.js"></script>
<script type="text/javascript" src="xpcom.webkit.js"></script>

<script type="text/javascript" src="main_menu.js"></script>
<script type="text/javascript" src="context_menu.js"></script>
<script type="text/javascript" src="player.js"></script>



<script type="text/javascript">

var ver = '4.3.2';
var debug = 0;
var stb;
var stbEvent;
var _GET = {};

var module = {};

window.onerror = function(msg, url, lno){
    _debug('line: '+lno+'; msg: "'+msg+'" url: '+url);
    return true;
}

get_params();

if (_GET.hasOwnProperty('debug')){
    debug = 1;
}

window.onload = init;

var loader = {
    
    chain : [],
    cur_idx : -1,
    head : document.getElementsByTagName("head")[0],
    max_load_percent : 50,
    step : 0,
    
    add : function(modules){
        _debug('loader.add');
        
        var modules = modules || [];
        
        this.chain = modules;
        
        this.step = Math.ceil(this.max_load_percent/this.chain.length);
        
        this.next();
    },
    
    next : function(){
        _debug('loader.next');
        
        if (this.cur_idx < this.chain.length-1){
            this.cur_idx++;
            this.append(this.chain[this.cur_idx]);
        }
    },
    
    append : function(module){
        _debug('loader.append');
        
        stb.loader.add_pos(this.step, 'append '+module);
        
        var _script = document.createElement('script');
        _script.type = "text/javascript";
        _script.src  = module + ".js";
        
        var _style = document.createElement('link');
        _style.type = "text/css";
        _style.rel = "stylesheet";
        _style.href = module + ".css";
        
        this.head.appendChild(_script);
        _debug('append', _script.src);
        this.head.appendChild(_style);
        _debug('append', _style.href);
    },
};

/**
 * Init STB.
 */
function init(){
    _debug('init');
    
    stb.loader = new load_bar();
    stb.loader.bind();
    
    stb.loader.set_callback(
        function(){
            stb.player.first_play();
        }
    );
    
    loader.add([
        "layer",
        "layer.sidebar",
        "layer.search_box",
        "layer.bottom_menu",
        "layer.scrollbar",
        "layer.vclub_info",
        "password_input",
        "series_switch",
        "vclub",
        "tv",
        "media_browser",
        "karaoke",
        "radio",
        "curweather",
        "records"
    ])
    
    
    /*{"title"    : "НАСТРОЙКИ",
         "cmd"      : "",
         "sub" : [
                      {
                        "title" : "ОБЩЕЕ",
                        "cmd"   : ""
                      },
                      {
                        "title" : "ВИДЕОВЫХОД",
                        "cmd"   : ""
                      },
                      {
                        "title" : "ЛИЧНЫЙ КАБИНЕТ",
                        "cmd"   : ""
                      },
                 ]
    }*/
    
    stb.init();

    try{
        main_menu.init();
    }catch(e){
        _debug(e);
    }
    
    (function(){
        
        if (stb.player.on){
            
            if (stb.player.con_menu.on){
                stb.player.con_menu.hide();
            }
            
            stb.player.stop();
            main_menu.show();
        }
        
    }).bind(key.MENU);
    
    (function(){
        
        //main_menu.show();
        //main_menu.hide();
        
        stb.cur_layer && stb.cur_layer.hide && stb.cur_layer.hide();
        
        stb.player.play_last();
        
    }).bind(key.TV);
    
    (function(){
        
        if(stb.power_off){
            stb.StandBy(0);
            stb.power_off = false;
            keydown_observer.emulate_key(key.MENU);
        }else{
            keydown_observer.emulate_key(key.MENU);
            stb.StandBy(1);
            stb.power_off = true;
        }
        
    }).bind(key.POWER);

    /* END LAYER MANAGEMENT */
    
}

var stbEvent = {
    onEvent : function(data){},
    event : 0
}

</script>

</head>
<body>
<img src="i/loading_bg.gif" width="0" height="0"></img>
<img src="i/loading.png" width="0" height="0"></img>
</body>
</html>